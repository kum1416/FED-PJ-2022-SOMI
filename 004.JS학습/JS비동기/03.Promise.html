<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>JSë¹„ë™ê¸° : 3. Promise ì‚¬ìš©ë²•</title>
        <script>
            /******************************************************************* 
              [í”„ë¼ë¯¸ìŠ¤(Promise)ë€? "ì›í•˜ëŠ” ê²°ê³¼ë¥¼ ë³´ì¥í•´! ì•½ì†í•´!"]

                "ìƒì„±ì½”ë“œ"ëŠ” ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆëŠ” ì½”ë“œì´ë‹¤.
                "ì‚¬ìš©ì½”ë“œ"ëŠ” ê²°ê³¼ë¥¼ ê¸°ë‹¤ë ¤ì•¼ í•˜ëŠ” ì½”ë“œì´ë‹¤.
                PromiseëŠ” ìƒì„± ì½”ë“œì™€ ì‚¬ìš©ì½”ë“œë¥¼ ì—°ê²°í•˜ëŠ” JavaScript ê°ì²´ë‹¤!
                __________________________________________________________

                ((êµ¬ë¬¸))
                let ì•½ì†ë³€ìˆ˜ = new Promise(function(ì„±ê³µí•¨ìˆ˜, ì‹¤íŒ¨í•¨ìˆ˜) { ğŸ“ì‹¤íŒ¨í•œê±°ì—†ìœ¼ë©´ ì‹¤íŒ¨í•¨ìˆ˜ ìƒëµê°€ëŠ¥
                // ìƒì„±ì½”ë“œ : ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì½”ë“œ

                ì„±ê³µí•¨ìˆ˜(ë¦¬í„´ê°’ì‚¬ìš©ê°€ëŠ¥); // ì„±ê³µì‹œí˜¸ì¶œ
                ì‹¤íŒ¨í•¨ìˆ˜(ë¦¬í„´ê°’ì‚¬ìš©ê°€ëŠ¥);  // ì—ëŸ¬ì‹œ í˜¸ì¶œ
                });

                // ì‚¬ìš©ì½”ë“œ : ì•½ì†ê°ì²´ê°€ ì™„ë£Œë ë•Œê¹Œì§€ ê¸°ë‹¤ë¦¼!!!
                ì•½ì†ë³€ìˆ˜.then( ğŸ“then()-> ë©”ì„œë“œ.. ì•ˆì— ì „ë‹¬ê°’ 2ê°œ!
                function(ë³€ìˆ˜) { ì„±ê³µì‹œì½”ë“œ },
                function(ë³€ìˆ˜) { ì‹¤íŒ¨ì‹œì½”ë“œ }
                );

                __________________________________________________________

                [ AJAX ë¹„ë™ê¸° íŒŒì¼ì²˜ë¦¬ ì „ì†¡ê°ì²´ ]
                AJAX (Asynchronous Javascript And XML) ë™ì‹œì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ”

                -> XMLHttpRequestê°ì²´

                1. íŠ¹ì§•:
                    (1) ì›¹ì„œë²„ì˜ ë°ì´í„° ì½ê¸°(í˜ì´ì§€ë¡œë“œí›„)
                    (2) í˜ì´ì§€ë¡œ ë¦¬ë¡œë“œí•˜ì§€ ì•Šê³  ì›¹í˜ì´ì§€ë¥¼
                        ë¶€ë¶„ì—…ë°ì´í„°í•¨
                    (3) ë°±ê·¸ë¼ìš´ë“œ ì›¹ì„œë²„ë¡œ ë°ì´í„° ì „ì†¡ê¸°ëŠ¥
                
                2. ì‚¬ìš©ë²•:
                    (1) ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ë³€ìˆ˜ì— í• ë‹¹í•˜ì—¬ ì‚¬ìš©
                     ì˜ˆ) let ajax = new XMLHttpRequesr();
                    (2) ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì—´ì–´ì„œ ì „ì†¡ì¤€ë¹„ë¥¼ í•œë‹¤
                    -> open(ë°©ì‹,ìš”ì²­URL,ì•„ì´ë””,ë¹„ë²ˆ,ë¹„ë™ê¸°ì˜µì…˜)
                    -> í•µì‹¬: open(ë°©ì‹,ìš”ì†ŒURL)
                        1) ë°©ì‹: GET/POST -> GETë°©ì‹ì„ ë” ì„ í˜¸í•¨
                            ì´ìœ ëŠ” ê°€ë³ê³  ë¹ ë¥´ê²Œ ì²˜ë¦¬í•¨
                            POSTë°©ì‹ì€ ë¯¼ê°í•œ ë°ì´í„° ì²˜ë¦¬ì‹œ ì‚¬ìš©!
                        2) ìš”ì²­URL : 
                            ì›¹ì„œë²„ì˜ í˜ì´ì§€ë‚˜ íŒŒì¼ê²½ë¡œì£¼ì†Œ
                        3) ì•„ì´ë””/ë¹„ë²ˆ : 
                            ì›¹ì„œë²„ ì ‘ê·¼ì‹œ ì¸ì¦ì´ í•„ìš”í•œ ê²½ìš° ì‚¬ìš©í•¨
                        4) ë¹„ë™ê¸°ì˜µì…˜ : ê¸°ë³¸ê°’ true -> ë¹„ë™ê¸°ì²˜ë¦¬
                            -> ì•„ë¬´ê²ƒë„ ì•ˆì“°ë©´ trueë¡œ ë¹„ë™ê¸°ì²˜ë¦¬ë¨!
                            ë§Œì•½ falseë¼ê³  í•˜ë©´ ë™ê¸°ì ì²˜ë¦¬ë¥¼ í•¨! ğŸ“ëŒ€ê¸°íƒ€ê³ ìˆëŠ”ê²ƒ?
                            -> ë¹„ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•´ì•¼ í˜ì´ì§€ê°€ 
                            ë©ˆì¶”ì§€ ì•Šê³  ìš”ì²­íŒŒì¼ë§Œ ë³„ë„ë¡œ ì²˜ë¦¬í•œë‹¤!
                        ì˜ˆ) ajax.open("GET","https://my.com/my.pdf")

                    (3) ë¹„ë™ê¸°ì „ì†¡ í›„ ì²˜ë¦¬ë¥¼ ìœ„í•œ ë¡œë“œí•¨ìˆ˜êµ¬ì—­ ë§Œë“¤ê¸°
                    -> 
                    ì¸ìŠ¤í„´ìŠ¤ë³€ìˆ˜.onload = function(){ì²˜ë¦¬ì†ŒìŠ¤};
                    -> ì—¬ê¸°ì„œ onloadë¼ëŠ” ê²ƒì€ ì„œë²„ì—ì„œ ê²°ê³¼ë¥¼ ë¡œë“œí•œë‹¤ëŠ” ì˜ë¯¸ì„!
                    -> ê²°ê³¼ì²˜ë¦¬ ìƒíƒœê°’ì€  : 
                        ì¸ìŠ¤í„´ìŠ¤ë³€ìˆ˜.status ê°’ìœ¼ë¡œ í•œë‹¤!
                        [ status ê²°ê³¼ìƒíƒœì¢…ë¥˜ ]
                            1) 200 : "OK" - ì²˜ë¦¬ì™„ë£Œë¨
                            2) 403 : "Forbidden" - íŒŒì¼ì ‘ê·¼ê±°ë¶€
                            3) 404 : "Not Found" - íŒŒì¼ì—†ìŒ
                            -> responseText ë¡œ ë°›ìœ¼ë©´ ìœ„ì˜ ë¬¸ìí˜•ìœ¼ë¡œ ë¦¬í„´í•œë‹¤!

                            [ response ê²°ê³¼ë‚´ìš© ì¢…ë¥˜ ]
                                1) responseText : ë°ì´í„°ë¥¼ ë¬¸ìí˜•ì‹ ë°›ê¸°
                                2) responseXML : ë°ì´í„°ë¥¼ XMLí˜•ì‹ ë°›ê¸°
                                3) responseURL : ë°ì´í„° ì „ì†¡ URL ë°›ê¸°

                    (4) ì˜¤í”ˆ ì…‹íŒ…ëœ ìš”ì²­ê°ì²´ë¥¼ ì „ì†¡í•œë‹¤!
                        ì¸ìŠ¤í„´ìŠ¤ë³€ìˆ˜.send()
                        -> open() -> onload -> send() ìˆœìœ¼ë¡œ ì½”ë”©

                        [ ì›¹ì„œë²„ íŒŒì¼ ìš”ì²­ì‹œ ì£¼ì˜ì‚¬í•­! ]
                        1. ìš”ì²­í•œ íŒŒì¼ì´ í˜„ì¬ í˜ì´ì§€ì˜ ë„ë©”ì¸ì£¼ì†Œì™€
                        ë‹¤ë¥¸ê²½ìš° (ì´ì¢…ë„ë©”ì¸) XSSê³µê²© ë“±ì˜ ì´ìœ ë¡œ
                        ë¸Œë¼ìš°ì €ì—ì„œ ì´ê²ƒì„ ê¸ˆì§€í•˜ê³  ìˆë‹¤!
                        (ì¼ë°˜ XMLHttpRequest ìš”ì²­ìœ¼ë¡œ ê°€ì ¸ì˜¤ê¸°ëŠ” ê°€ëŠ¥í•¨!)

                        2. Promiseë¥¼ ì‚¬ìš©í•˜ì—¬ íŒŒì¼ì„ ìš”ì²­í•˜ê³ 
                        ì—ëŸ¬ë°œìƒì‹œ ì´ê²ƒì„ ì‹¤íŒ¨í•¨ìˆ˜ë¡œ ì²˜ë¦¬í• ë•Œ
                        ì´ì¢…ë„ë©”ì¸ ì—ëŸ¬ëŠ” Promiseì˜ ì—ëŸ¬ë„ ë°œìƒì‹œí‚¤ë¯€ë¡œ
                        ì‹¤íŒ¨í•¨ìˆ˜ì²˜ë¦¬ê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤!!!

                        3. ì´ê²ƒì€ ê·¼ë³¸ì ì¸ ë¸Œë¼ìš°ì € ì •ì±…ì´ë¯€ë¡œ
                        í•´ê²°ë°©ë²•ì€ ê°™ì€ ë„ë©”ì¸ì— íŒŒì¼ì„ ìš”ì²­í•˜ëŠ” ê²ƒì´ë‹¤! (ì™¸ë¶€ë„ë©”ì¸ íŒŒì¼ì„ ê°™ì€ ì„œë²„ì— ì €ì¥í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤!)


         *******************************************************************/

         function í™”ë©´ë¿Œë ¤(ì´ê±°) {
            document.getElementById("show").innerHTML += ì´ê±° + "<br>";
        }

        ////// ë¡œë“œêµ¬ì—­ ///////////////////
        window.addEventListener("load",()=>{
            
            // 1. ê¸°ë³¸ ì•½ì†ê°ì²´ ë§Œë“¤ê¸°
            let ì²˜ìŒì•½ì† = new Promise(
                function(ì„±ê³µí•¨ìˆ˜,ì‹¤íŒ¨í•¨ìˆ˜){
                    let í†µê³¼ = 1; // 1-ì„±ê³µí…ŒìŠ¤íŠ¸, 0-ì‹¤íŒ¨í…ŒìŠ¤íŠ¸

                    // ì´ ìë¦¬ì—ëŠ” ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì‹¤í–‰ì½”ë“œê°€ ìœ„ì¹˜í•¨!

                    if(í†µê³¼){
                        ì„±ê³µí•¨ìˆ˜("ì„±ê³µ!!!");
                    }
                    else{
                        ì‹¤íŒ¨í•¨ìˆ˜("ì—ëŸ¬ë‚¨!!!")
                    }

            }); ////////// Promise ////////////////

            // í”„ë¼ë¯¸ìŠ¤ì—ì„œ í˜¸ì¶œë˜ëŠ” ì²˜ë¦¬í›„ ì‹¤í–‰ë©”ì„œë“œ : 
            // then(í•¨ìˆ˜1,í•¨ìˆ˜2)
            // í•¨ìˆ˜1 - ì„±ê³µì‹œì‹¤í–‰êµ¬ì—­
            // í•¨ìˆ˜2 - ì‹¤íŒ¨ì‹œì‹¤í–‰êµ¬ì—­
            ì²˜ìŒì•½ì†.then(
                // ì„±ê³µì‹œ ì‹¤í–‰í•¨ìˆ˜
                function(ì „ë‹¬ë³€ìˆ˜){
                    í™”ë©´ë¿Œë ¤(ì „ë‹¬ë³€ìˆ˜);
                },
                // ì‹¤íŒ¨ì‹œ ì‹¤í–‰í•¨ìˆ˜
                function(ì „ë‹¬ë³€ìˆ˜){
                    í™”ë©´ë¿Œë ¤(ì „ë‹¬ë³€ìˆ˜);
                }); //////// then ë©”ì„œë“œ ///////


            // 2. ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì½”ë“œë¥¼ ì•½ì†ê°ì²´ì— ë„£ê³  ì²˜ë¦¬í•˜ê¸°
            // new Promise(function(ë³€ìˆ˜){}) 
            // -> í•˜ë‚˜ì˜ ë³€ìˆ˜ëŠ” ì„±ê³µì²˜ë¦¬í•¨ìˆ˜ë‹¤!
            let ì•½ì†ê¸°ë‹¤ë¦¼ = new Promise(function(ì„±ê³µ){
                // ì²˜ë¦¬ì‹œê°„ì´ ê±¸ë¦¬ëŠ” ì½”ë“œë„£ê¸°
                setTimeout(function(){
                    // ì„±ê³µí•¨ìˆ˜í˜¸ì¶œ!
                    ì„±ê³µ("ì˜¤ë§ˆì´ê°“ê¹€ì¹˜!!!");
                }, 3000); ////// setTimeout ////
            }); /////////// ì•½ì†ê¸°ë‹¤ë¦¼ Promise ////////

            // ì•½ì†ê°ì²´ë¡œ ë¶€í„° ì²˜ë¦¬í›„ thenë©”ì„œë“œì— ì‹¤í–‰ì½”ë“œ ë„£ê¸°
            // then(í•¨ìˆ˜) -> í•˜ë‚˜ì˜ í•¨ìˆ˜ë§Œ ì“°ë©´ ì„±ê³µì²˜ë¦¬í•¨ìˆ˜ë¥¼ ë°›ìŒ!
            ì•½ì†ê¸°ë‹¤ë¦¼.then(function(ê°’){
                í™”ë©´ë¿Œë ¤("ì™€~~~ìš°!"+ê°’);
                í™”ë©´ë¿Œë ¤(`<img src="https://ojsfile.ohmynews.com/STD_IMG_FILE/2014/0103/IE001663873_STD.jpg" style="height:70vh" alt="ì•½ì†">`);
            }); ////////// thenë©”ì„œë“œ /////////////

            // 3. íŒŒì¼ì„ ì „ì†¡ ë°›ì€ í›„ ì‹¤í–‰í•˜ëŠ” ì•½ì†ê°ì²´ ìƒì„±í•˜ê¸°
            let íŒŒì¼ì•½ì† = new Promise(
                function(ì„±ê³µí•¨ìˆ˜,ì‹¤íŒ¨í•¨ìˆ˜){
                    // ì•„ì‘ìŠ¤(ë¹„ë™ê¸°í†µì‹ ) ì„œë²„íŒŒì¼ìš”ì²­í•˜ê¸°
                    
                    // (1) XMLHttpRequest ê°ì²´ ì¸ìŠ¤í„´ìŠ¤ ë§Œë“¤ê¸°
                    let ajax = new XMLHttpRequest();

                    // (2) ë¹„ë™ê¸° íŒŒì¼ìš”ì²­ ì—´ê¸°(ì „ì†¡ê¸°ëŠ¥ë©”ëª¨ë¦¬ìƒì„±)
                    ajax.open("GET","VogueWF.pdf");
                    // ê°™ì€ ë„ë©”ì¸ì˜ íŒŒì¼ì„ Promiseì²˜ë¦¬í•´ì•¼
                    // ì‹¤íŒ¨ì²˜ë¦¬ê¹Œì§€ ëª¨ë‘ ì™„ì „í•˜ê²Œ ì´ë£¨ì–´ì§„ë‹¤!

                    // ajax.open("GET","https://tombap8.github.io/FED-PJ-2022-tom/001.HTML%ED%95%99%EC%8A%B5/06.CGV_PJ/001.%EB%B6%84%EC%84%9D%EC%84%A4%EA%B3%84/CGV_Mockup.pdf");

                    // (3) ê²°ê³¼ë¥¼ ë¦¬í„´ë°›ëŠ” onloadì´ë²¤íŠ¸ í•¨ìˆ˜êµ¬ì—­ë§Œë“¤ê¸°
                    ajax.onload = function(){ //function í™”ì‚´í‘œí•¨ìˆ˜ë¡œ ì¨ë„ëŒ / onload ê²°ê³¼ê°€ ë¡œë”©ë˜ê³  ë‚˜ë©´ í•¨ìˆ˜êµ¬ì—­ì„ ì‹¤í–‰í•´
                        console.log(ajax.status,this);
                        if(ajax.status==200){
                            ì„±ê³µí•¨ìˆ˜(ajax.responseURL);
                            // ì„±ê³µì‹œ ì „ì†¡ë°›ì€ íŒŒì¼ URLì„ ë°›ëŠ”ë‹¤!
                        }
                        else{
                            ì‹¤íŒ¨í•¨ìˆ˜(ajax.statusText);
                            // ì‹¤íŒ¨ ê²°ê³¼ë¥¼ ë¬¸ìí˜•ìœ¼ë¡œ ìƒíƒœê°’ ë³´ë‚´ì£¼ê¸°
                        }
                    }; //////// onload //////////////

                    // (4) ë¹„ë™ê¸° ìš”ì²­ë³´ë‚´ê¸° : send()
                    ajax.send();                   
                }); ///////// íŒŒì¼ì•½ì† Promise /////////

                íŒŒì¼ì•½ì†.then(
                    function(ì„±ê³µë©”ì‹œì§€){ //ğŸ“ì•„ë˜ì“´ ì„±ê³µë©”ì‹œì§€ë¥¼ ë°›ìŒ
                        console.log("ìš”ê¸°!",ì„±ê³µë©”ì‹œì§€)
                        í™”ë©´ë¿Œë ¤("íŒŒì¼ë¡œë”©ì™„ë£Œ!",ì„±ê³µë©”ì‹œì§€);
                        document.getElementById("doc").innerHTML=
                        `<iframe src="${ì„±ê³µë©”ì‹œì§€}" style="width:100%;height:100%"></iframe>`;
                    },
                    function(ì‹¤íŒ¨ë©”ì‹œì§€){
                        í™”ë©´ë¿Œë ¤(ì‹¤íŒ¨ë©”ì‹œì§€);
                    }); ///////// íŒŒì¼ì•½ì† then /////////

        }); /////////////// load ////////////////


            
        </script>
        <style>
            @import url("https://fonts.googleapis.com/css2?family=Gamja+Flower&display=swap");
            body {
                background-image: linear-gradient(to bottom, #494949, gray);
                background-repeat: no-repeat;
                background-attachment: fixed;
                text-align: center;
            }
            #show {
                font-family: "Gamja Flower", cursive;
                font-size: 4vw;
                background-image: linear-gradient(to bottom, lightgreen, pink, orangered, aquamarine);
                background-clip: text;
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-repeat: no-repeat;
                font-weight: bold;
            }
            #doc{
                width: 50%;
                height: 50vh;
                margin: 0 auto;
            }
        </style>
    </head>
    <body>
        <div id="show"></div>
        <div id="doc"></div>
    </body>
</html>
